<div class="reflexions-container">
  <div class="page-header">
    <h1>Réflexions</h1>
    @if (isAuthenticated) {
      <button class="btn-add" (click)="openCreateForm()" aria-label="Ajouter une réflexion">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Ajouter
      </button>
    }
  </div>

  <div class="intro-text">
    <p>Explorez mes réflexions, des pensées et des considérations sur divers sujets et thèmes.</p>
  </div>

  <!-- État de chargement -->
  @if (isLoading) {
    <div class="loading-state">
      <p>Chargement des réflexions...</p>
    </div>
  }

  <!-- Affichage des erreurs -->
  @if (error) {
    <div class="error-state">
      <p>{{ error }}</p>
    </div>
  }

  <!-- Liste des réflexions -->
  @if (!isLoading && !error) {
    <div class="reflexions-list">
      @for (reflexion of reflexions; track reflexion.id) {
        <div class="reflexion-item">
          <div class="reflexion-header" (click)="toggleReflexion(reflexion)">
            <h3 class="reflexion-title">{{ reflexion.title }}</h3>
            <div class="reflexion-actions">
              @if (isAuthenticated) {
                <button class="btn-edit" (click)="openEditForm(reflexion.id); $event.stopPropagation()" aria-label="Éditer la réflexion">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                  Éditer
                </button>
              }
              <button class="expand-button" [class.expanded]="reflexion.isExpanded" aria-label="Déplier la réflexion">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
            </div>
          </div>

          @if (reflexion.isExpanded) {
            <div class="reflexion-content">
              @if (reflexion.isLoading) {
                <div class="content-loading">
                  <p>Chargement du contenu...</p>
                </div>
              }
              @if (!reflexion.isLoading && reflexion.content) {
                <div class="content-text">
                  <p [innerHTML]="reflexion.content"></p>
                </div>
              }
            </div>
          }
        </div>
      }

      @if (reflexions.length === 0) {
        <div class="empty-state">
          <p>Aucune réflexion disponible pour le moment.</p>
        </div>
      }
    </div>
  }

  <!-- Formulaire de contenu -->
  @if (showForm) {
    <app-content-form
      [contentType]="'reflexion'"
      [existingContent]="editingReflexion"
      [isSubmitting]="formSubmitting"
      (onSubmit)="onFormSubmit($event)"
      (onCancel)="onFormCancel()"
      (onDelete)="onDelete($event)"
    ></app-content-form>
  }
</div>
